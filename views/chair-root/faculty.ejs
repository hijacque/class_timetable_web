<div class="bg-light task-view px-5 py-4" id="faculty-view">
    <h2 style="color: #8673b4;" id="table-title">Faculty in <%= data.department.name %> Department</h2>
    <br>
    <button class="btn btn-primary btn-rounded" data-cts-toggle="table" data-cts-target="#faculty-table">
        <i class="fas fa-edit fa-lg me-2"></i>edit table</button>
    <button class="btn btn-success btn-rounded" data-cts-dismiss="table" data-cts-target="#faculty-table"
        aria-hidden="true">save changes</button>
    <table class="table table-bordered table-sm fw-bold my-4 editable" id="faculty-table">
        <thead class="text-center">
            <tr>
                <th class="data-title" style="width: 155px;">ID</th>
                <th class="data-title" style="width: 140px;">Status</th>
                <th class="data-title" style="width: 80px;">Load</th>
                <th class="data-title">First Name</th>
                <th class="data-title">Middle Name</th>
                <th class="data-title">Surname</th>
                <th class="data-title" style="width: 200px;">E-mail</th>
                <th class="data-title" style="width: 150px;">Current Schedule</th>
                <td class="edit-title">Action</td>
            </tr>
        </thead>
        <tbody></tbody>
        <tfoot>
            <tr class="add-data">
                <td><input id="faculty_id" type="text" class="form-control w-100 add-td-input unique" title="ID"></td>
                <td>
                    <div class="dropdown">
                        <button class="btn btn-secondary dropdown-toggle add-td-input" type="button" id="status"
                            data-mdb-toggle="dropdown" aria-expanded="false" title="Status">Status</button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" role="button">full-time</a></li>
                            <li><a class="dropdown-item" role="button">part-time</a></li>
                        </ul>
                    </div>
                </td>
                <td><input id="teach_load" type="number" title="Load" class="form-control w-100 add-td-input">
                </td>
                <td><input id="first_name" type="text" title="First Name" class="form-control w-100 add-td-input"
                        placeholder="Juan">
                </td>
                <td><input id="middle_name" type="text" title="Middle Name" class="form-control w-100 add-td-input"
                        placeholder="Antonio">
                </td>
                <td><input id="last_name" type="text" title="Last Name" class="form-control w-100 add-td-input"
                        placeholder="Dela Cruz">
                </td>
                <td><input id="email" type="email" title="E-mail" class="form-control w-100 add-td-input unique"
                        placeholder="jadelacruz@school.edu.ph">
                </td>
                <td class="add-td-input optional" id="schedule" title="Current Schedule"></td>
            </tr>
        </tfoot>
    </table>
</div>
<script src="/lib/responsive-table.js"></script>
<script>
    const getFaculty = (departmentID) => new Promise((resolve, reject) => {
        $.get("http://localhost:3000/api/faculty/" + departmentID,
            (data, status) => {
                resolve(data.faculty);
            }, "json"
        ).fail((data) => reject(data));
    });


    const addFaculty = (departmentID, facultyData) => $.post(
        "http://localhost:3000/api/faculty/" + departmentID, facultyData,
        (data, status) => {
            console.log(data);
        }, "json"
    );

    const deptID = "<%= data.department.id %>";
    const facultyTable = new ResponsiveTable("#faculty-table");
    facultyTable.initData(getFaculty(deptID), true);
    $(facultyTable.addBtn).click(async (event) => {
        try {
            let addedData = await $(event.currentTarget).data("newRow");
            if (addedData) { addFaculty(deptID, addedData); }
        } catch (error) {
            $(`${facultyTable.body}:last-child`).remove();
            facultyTable.data.pop();
        }
        $(event.currentTarget).removeData("newRow");
    });
</script>